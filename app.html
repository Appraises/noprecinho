<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="description"
    content="Compare pre√ßos em tempo real. Crowdsourcing de pre√ßos de mercado, farm√°cia, pet shop e posto de combust√≠vel." />
  <meta name="theme-color" content="#F8FAFC" />

  <title>NoPrecinho - Waze para Pre√ßos</title>

  <!-- Favicon & PWA -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="manifest" href="/public/manifest.json" />
  <link rel="apple-touch-icon" href="/public/icons/icon-192.png" />

  <!-- Preconnect to external resources -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preconnect" href="https://tile.openstreetmap.org" />

  <!-- Auth Check -->
  <script>
    if (!localStorage.getItem('precoja_auth_token')) {
      window.location.replace('/login.html');
    }

    // Initialize theme EARLY (before CSS loads) to prevent flash
    (function () {
      var savedTheme = localStorage.getItem('precoja_theme');
      // Default to light if no preference saved
      var theme = (savedTheme === 'dark') ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', theme);
    })();
  </script>

  <!-- Main entry point -->
  <script type="module" src="/src/main.js"></script>
</head>

<body>
  <!-- Skip Link for Accessibility -->
  <a href="#map" class="skip-link">Pular para o mapa</a>

  <div id="app">
    <!-- Header -->
    <header class="header" role="banner">
      <div class="header__logo">
        <svg class="header__logo-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2">
          <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z" />
          <circle cx="12" cy="9" r="2.5" />
        </svg>
        <span class="header__logo-text">NoPrecinho</span>
      </div>

      <div class="header__search">
        <svg class="header__search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2">
          <circle cx="11" cy="11" r="8" />
          <path d="m21 21-4.35-4.35" />
        </svg>
        <input type="search" class="header__search-input" id="search-input"
          placeholder="Buscar produto, loja ou bairro..." autocomplete="off" aria-label="Buscar" />
        <button class="header__search-clear hidden" id="search-clear" aria-label="Limpar busca" type="button">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M18 6L6 18M6 6l12 12" />
          </svg>
        </button>
        <div id="search-suggestions" class="search-suggestions hidden"></div>
      </div>

      <div class="header__actions">
        <div class="header__points" id="points-badge" title="Seus pontos">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
          </svg>
          <span id="points-count">0</span>
          <span>pontos</span>
        </div>

        <button class="header__btn" id="theme-toggle" aria-label="Alterar tema"
          style="background: none; border: none; cursor: pointer; color: var(--color-text-secondary); display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 50%;">
          <!-- Icon injected by JS -->
        </button>

        <button class="header__avatar" id="user-avatar" aria-label="Menu do usu√°rio">
          <span>U</span>
        </button>
      </div>
    </header>

    <!-- Category Filters -->
    <nav class="filter-bar" role="navigation" aria-label="Categorias">
      <button class="chip chip--active" data-category="all">
        <span>Todos</span>
      </button>
      <button class="chip" data-category="mercado">
        <span class="chip__icon">üõí</span>
        <span>Mercado</span>
      </button>
      <button class="chip" data-category="hortifruti">
        <span class="chip__icon">ü•¨</span>
        <span>Hortifr√∫ti</span>
      </button>
      <button class="chip" data-category="farmacia">
        <span class="chip__icon">üíä</span>
        <span>Farm√°cia</span>
      </button>
      <button class="chip" data-category="pet">
        <span class="chip__icon">üêæ</span>
        <span>Pet</span>
      </button>
      <button class="chip" data-category="combustivel">
        <span class="chip__icon">‚õΩ</span>
        <span>Combust√≠vel</span>
      </button>
      <button class="chip" data-category="outros">
        <span class="chip__icon">üì¶</span>
        <span>Outros</span>
      </button>
    </nav>

    <!-- Main Content Area -->
    <main class="main-content">
      <!-- Map Container -->
      <div id="map" class="map-container" role="application" aria-label="Mapa de pre√ßos"></div>

      <!-- Store Preview Panel -->
      <aside id="store-preview" class="store-preview" aria-live="polite">
        <div class="store-preview__header">
          <div class="store-preview__icon" id="preview-icon">üè™</div>
          <div class="store-preview__info">
            <h2 class="store-preview__name" id="preview-name">Nome da Loja</h2>
            <div class="store-preview__meta" id="preview-category">
              <span>Categoria</span>
              <span>‚Ä¢</span>
              <span>0.0 km</span>
            </div>
            <div class="store-preview__route hidden" id="preview-route-info">
              <span class="route-icon">üöó</span>
              <span id="preview-duration">0 min</span>
              <span>‚Ä¢</span>
              <span id="preview-route-dist">0.0 km</span>
            </div>
          </div>
          <button class="btn btn--ghost btn--icon-sm store-preview__close" id="preview-close">√ó</button>
        </div>

        <div class="store-preview__footer">
          <div style="flex: 1;">
            <div class="text-xs text-muted mb-1">Melhor pre√ßo</div>
            <div class="text-xl font-bold text-primary" id="preview-price">R$ 0,00</div>
          </div>
          <div style="display: flex; gap: 8px;">
            <button class="btn btn--secondary" id="preview-report-btn" title="Reportar pre√ßo">
              + Pre√ßo
            </button>
            <button class="btn btn--primary" id="preview-details-btn">
              Detalhes
            </button>
          </div>
        </div>
      </aside>

      <!-- Floating Controls -->
      <div class="floating-controls">
        <button class="floating-fab" id="report-btn" aria-label="Reportar pre√ßo">
          <span>+</span>
        </button>
        <button class="floating-btn" id="filter-btn" aria-label="Filtros">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" />
          </svg>
        </button>
        <button class="floating-btn" id="location-btn" aria-label="Minha localiza√ß√£o">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3" />
            <path d="M12 2v2M12 20v2M2 12h2M20 12h2" />
          </svg>
        </button>
        <button class="floating-btn" id="shopping-list-btn" aria-label="Lista de compras">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="9" cy="21" r="1" />
            <circle cx="20" cy="21" r="1" />
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61H19a2 2 0 0 0 2-1.61L23 6H6" />
          </svg>
        </button>
      </div>

      <!-- Map Legend -->
      <div class="map-legend" id="map-legend">
        <div class="map-legend__title">Legenda</div>
        <div class="map-legend__item">
          <div class="map-legend__color" style="background: var(--color-primary);"></div>
          <span>Loja selecionada</span>
        </div>
        <div class="map-legend__item">
          <div class="map-legend__color"
            style="background: var(--color-surface); border: 2px solid var(--color-primary);"></div>
          <span>Comprovado</span>
        </div>
      </div>

      <!-- Price List Panel -->
      <aside class="side-panel" id="price-panel"
        style="position: absolute; top: 0; right: 0; transform: translateX(100%); transition: transform 0.3s; width: 360px; border-left: 1px solid var(--color-border); z-index: 1000;"
        aria-label="Lista de pre√ßos">
        <div class="side-panel__header">
          <h2 class="side-panel__title">Melhores pre√ßos</h2>
          <button class="btn btn--ghost btn--icon" id="panel-toggle" aria-label="Fechar">√ó</button>
        </div>
        <div class="side-panel__content" id="price-list">
          <!-- Price cards inserted via JS -->
        </div>
      </aside>
    </main>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container" aria-live="polite"></div>

    <!-- Report Price Modal -->
    <div class="modal-overlay" id="report-modal" role="dialog" aria-modal="true">
      <div class="modal">
        <div class="modal__header">
          <h2 class="modal__title">Reportar pre√ßo</h2>
          <button class="modal__close" id="modal-close">&times;</button>
        </div>
        <div class="modal__body" id="modal-body"></div>
        <div class="modal__footer" id="modal-footer"></div>
      </div>
    </div>

    <!-- Filter Modal -->
    <div class="modal-overlay" id="filter-modal" role="dialog" aria-modal="true">
      <div class="modal">
        <div class="modal__header">
          <h2 class="modal__title">Filtros</h2>
          <button class="modal__close" id="filter-modal-close">&times;</button>
        </div>
        <div class="modal__body">
          <div class="form-group">
            <label class="form-label">Raio de busca: <span id="radius-value">5</span> km</label>
            <input type="range" class="form-input" id="radius-slider" min="1" max="25" value="5" />
          </div>

          <div class="form-group">
            <label class="form-label">Op√ß√µes</label>
            <div class="flex flex-col gap-2">
              <label class="checkbox-label">
                <input type="checkbox" class="checkbox-input" id="filter-fresh" checked />
                <span>Somente pre√ßos recentes (48h)</span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" class="checkbox-input" id="filter-verified" />
                <span>üì∏ Comprovado com nota</span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" class="checkbox-input" id="filter-open" />
                <span>Aberto agora</span>
              </label>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Ordenar por</label>
            <select class="form-select" id="sort-by">
              <option value="price">Menor pre√ßo</option>
              <option value="distance">Mais pr√≥ximo</option>
              <option value="recency">Mais recente</option>
              <option value="trust">Mais confi√°vel</option>
            </select>
          </div>
        </div>
        <div class="modal__footer">
          <button class="btn btn--secondary" id="filter-reset">Limpar</button>
          <button class="btn btn--primary" id="filter-apply">Aplicar</button>
        </div>
      </div>
    </div>

    <!-- Store Detail Modal -->
    <div class="modal-overlay" id="store-detail-modal" role="dialog" aria-modal="true">
      <div class="modal" style="max-width: 600px;">
        <div class="modal__header" id="store-detail-header"></div>
        <div class="modal__body" id="store-detail-body"></div>
      </div>
    </div>
  </div>
</body>

</html>